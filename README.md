# textfmt

テキストの末尾の改行と空白を整えるコマンドラインツールです。

## インストール

```bash
go install github.com/naoyafurudono/textfmt@latest
```

## 使い方

```bash
# 標準入力から
cat input.txt | textfmt

# ファイルを直接処理
textfmt file.txt
textfmt file1.txt file2.txt
```

## 機能

- 行末尾に空白文字がないようにする
- 入力末尾を空でない改行で終わる行にする

## 例

```bash
# 標準入力から
echo -e "行1  \n行2　\n行3\t\n" | textfmt
# 出力:
# 行1
# 行2
# 行3

# ファイルを直接処理
textfmt test.txt
```

### pre-commit hookとして実行

```bash
#!/bin/bash

# ステージされた追加/変更ファイル一覧を取得
files=$(git diff --cached --name-only --diff-filter=AM)

# textfmt がなければ exit
if ! command -v textfmt &>/dev/null; then
    echo "textfmt could not be found"
    echo "go install github.com/naoyafurudono/textfmt@latest"
    exit 1
fi

# 末尾改行を補完する処理
for f in $files; do
    # 自動生成されたファイルかどうかをチェック
    is_autogenerated=$(git check-attr linguist-generated -- "$f" | grep -c "linguist-generated: set")
    
    # ファイルが存在し、テキストファイルで、自動生成されたファイルでない場合のみ処理
    if [ -f "$f" ] && git grep -Iq . -- "$f" && [ "$is_autogenerated" -eq 0 ]; then
        textfmt "$f"
        git add "$f" # 修正をステージに追加
    fi
done

exit 0 # 通常のコミット続行
```
